import { Split } from 'mdx-deck/layouts';

# Building blocks 游빔

---

## Query

- Single endpoint
- Structure of the data is flexible
- Client declares its data needs

---

```graphql Query Spotify user
query {
  me {
  	id
  	email
  	display_name
  	country
  }
}
----
*
1, 8
2, 7
3:6
```

---

```json Response
{
  "data": {
    "me": {
      "id": "11124253812",
      "email": "matepapp@icloud.com",
      "display_name": "Mate Papp",
      "country": "HU"
    }
  }
}
----
*
2, 9
3, 8
4:7
```

---

```graphql Query with name, arguments and objects
query CurrentAccountQuery {
  account(number: "12345678-87654321-24681012") {
    name
    number
    type
    currency
    balance {
      amount
      currency
    }
    cards {
      name
      number
    }
  }
}
----
*
1, 16 > Query's Name
2, 15 > 'number' argument
3:6 > Scalar types
7:10 > Money Object
11:14 > Array of Card Object
```

---

```json Response
{
  "data": {
    "account": {
      "name": "Deviza sz치mla",
      "number": "12345678-87654321-24681012",
      "type": "CURRENT",
      "currency": "EUR",
      "balance": {
        "amount": 500,
        "currency": "EUR"
      },
      "cards": [
        {
          "name": "Euro k치rtya",
          "number": "1111-2222-3333-4444"
        },
        {
          "name": "T치rsk치rtya",
          "number": "9999-8888-7777-6666"
        }
      ]
    }
  }
}
----
*
3
4:7 > Scalar types responses
6, 7 > Enums
8:11 > Money response
12:21 > Array of Card response
```

---

## Mutation

- `Query` with side effect
- Any operations that cause writes
- **C** _(R)_ **U** **D**

---

```graphql Updating a Card's name
mutation UpdateCardNameMutation {
  updateCardName(number: "9999-8888-7777-6666" name: "Euro T치rsk치rtya") {
    number
    name
    limit
  }
}
----
*
1, 7 > 'mutation' keyword is required
2, 6
3:5
```

---

```json
{
  "data": {
    "updateCard": {
      "number": "9999-8888-7777-6666",
      "name": "Euro T치rsk치rtya",
      "limit": 600
    }
  }
}
----
*
3:7
```

---

## Subscription

- Realtime connection to the server
- Stream of data
- Wrapper around websockets

---

```graphql
subscription NewTrasaction {
  newTrasaction {
    number
    date
  }
}
----
*
1, 6
2:5
```

---

```json
{
  "data": {
    "newTrasaction": {
      "number": "QWERTY1234",
      "date": "201902010914"
    }
  }
}
```

---

## Schema and Schema Definition Language _(SDL)_

- GraphQL's own strongly typed language
- Schema specifies the capabilities of the API
- A contract between the server and client
- Special root types `Query`, `Mutation`, `Subscription`

---

## Scalar types

- Int
- Float
- String
- Boolean
- ID

---

```graphql Objects
type Account {
  id: ID!
  number: String!
  name: String!
  type: AccountType!
  currency: Currency!
  balance: Money!
  bookedTransactions: Money
  cards: [Card!]
}

type Card {
  id: ID!
  number: String!
  name: String!
  holderName: String
  expiry: DateTime!
  account: Account
  cvc: String!
  limit: Int!
}
----
*
1:10
12:21
```

---

```graphql Enumerations
enum TransactionStatus {
  IN_PROGRESS
  REJECTED
  FUTURE
  SUCCESSFUL
}

enum AccountType {
  SAVINGS
  CREDIT
  WEBCARD
  CURRENT
}

enum Currency {
  EUR
  USD
  GBP
  HUF
}
----
*
1:6
8:14
15:22
```

---

```graphql Root types
type Schema {
  query: Query
  mutation: Mutation
}

type Query {
  account(number: String!): Account
  accounts: [Account]!
  card(number: String!): Card
  cards: [Card]!
  category(id: ID!): Category
  categories: [Category]!
  transaction(number: String!): Transaction
  transactions: [Transaction]!
}

type Mutation {
  updateAccountName(number: String!, name: String!): Account
  updateCardName(number: String!, name: String!): Card
  deleteCard(number: String!): Card
  updateCategory(id: ID!, name: String!): Category
  changeTransactionCategory(number: String!, categoryID: ID!): Transaction
}
----
1:4
6:15
17:23
```
